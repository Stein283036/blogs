# Transaction

## 概述

事务（Transaction）是指一系列数据库操作，被视为一个单独的工作单元，要么全部执行，要么全部不执行。事务的目的是保持数据库的一致性和完整性，确保在一系列操作中发生错误时，数据库不会处于不一致的状态。

例如转账时就需要进行事务控制，防止一方转账成功金额减少了，而另一方收款失败导致金额没有增加。

## 四大特征

事务的四大特征（**ACID**）指的是原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）和持久性（Durability）。这些特征描述了事务应该满足的基本属性，确保数据库在并发环境下能够正确地处理事务。

原子性要求一个事务中的所有操作要么全部执行成功，要么全部不执行。如果在事务执行过程中发生错误，事务应该被回滚（Rollback）到起始状态，使得数据库状态不受影响。

一致性要求一个事务执行前后数据库的状态保持一致。即使在事务执行期间发生错误，数据库也应该能够回滚到一致的状态。一致性确保了数据库在任何时间点都是有效的。

隔离性指的是多个事务并发执行时，每个事务的操作应该被隔离开来，互不干扰。一个事务的中间状态对其他事务应该是不可见的，直到该事务提交。这防止了并发执行时的数据不一致性问题。

持久性要求一旦事务提交，对数据库的修改应该是永久的，即使在系统发生故障或崩溃的情况下，已提交的事务的结果也应该得到保留。通常，持久性通过将事务的操作保存到磁盘介质中。

## 隔离级别

在 MySQL 中，**默认的隔离级别是可重复读（Repeatable Read）**。

MySQL 提供了多个隔离级别，常见的有四个：

1. **读未提交（Read Uncommitted）：**
   - 允许一个事务读取另一个事务尚未提交的数据，可能导致脏读。
   - MySQL 中对应隔离级别：`READ UNCOMMITTED`
2. **读已提交（Read Committed）：**
   - 一个事务只能读取已经提交的其他事务的数据，解决了脏读问题，但仍可能导致不可重复读和幻读问题。
   - MySQL 中对应隔离级别：`READ COMMITTED`。
3. **可重复读（Repeatable Read）：**
   - 保证在事务执行期间同一查询返回相同的结果，即使其他事务对数据进行了修改，解决了脏读和不可重复读问题，但仍可能导致幻读问题。
   - MySQL 中对应隔离级别：`REPEATABLE READ`。
4. **串行化（Serializable）：**
   - 最高的隔离级别，确保事务按照串行方式执行，不允许并发，解决了脏读、不可重复读和幻读问题，但性能较差。
   - MySQL 中对应隔离级别：`SERIALIZABLE`。

随着隔离级别的增加，事务的隔离性增强，但也会带来性能的损失。因此，在选择隔离级别时需要权衡数据的一致性和性能的需求。一般来说，对于大多数应用，使用默认的隔离级别（Read Committed）是合理的选择。
